@page "/Config/ListPedidos"
@using Radzen
@using Radzen.Blazor
<h3>Lista de pedidos</h3>
<label>Filtrar por: </label>
<select  @onchange="actualizar"  class="form-control">
    <option value="0"selected="selected">Todos</option>
    <option value="1">Proceso</option>
    <option value="2">Enviados</option>
    <option value="3">Completados</option>
</select>
<br />
@if (pedidos.Count < 0)
{
    <p><em>Cargando...</em></p>
}
else
{
    <div class="row">
        <div class="col-x1-6">
            <RadzenGoogleMap Style="height: 400px; width: 600px; " zoom="@zoom" Center="@(new GoogleMapPosition() {Lat = pedidos.FirstOrDefault().Latitud,
                                                                         Lng = pedidos.FirstOrDefault().Longitud})">
                <Markers>
                    @foreach (var pedido in pedidos)
                    {
                        <RadzenGoogleMapMarker Title="@pedido.Id.ToString()" Label="@pedido.Estado" Position="@(new GoogleMapPosition() {Lat = pedido.Latitud, Lng = pedido.Longitud})" />
                    }
                </Markers>
            </RadzenGoogleMap>
        </div>
    </div>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <table class="table">
        <thead class="thead-dark">
            <tr style="text-align:center;">
                <th scope="col">Id</th>
                <th scope="col">Usuairo</th>
                <th scope="col">Total</th>
                <th scope="col">Estado</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var pedido in pedidos)
            {
                <tr style="text-align:center;">
                    <td></td>
                    <td>@pedido.Id</td>
                    <td>@pedido.UserId</td>
                    <td>@pedido.PrecioTotal</td>
                    <td>@pedido.Estado</td>
                    <td>
                        <a href="/Config/EditProducts/@pedido.Id" class="btn btn-primary btn-xs" title="Editar">
                            <i class="oi oi-pencil"></i>
                        </a>
                        <a href="/Config/DeleteProducts/@pedido.Id" class="btn btn-danger btn-xs" title="Detalles">
                            detalles
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
@code {
    string filtro = "0";
    double zoom = 3;
    List<Pedido> pedidos;

    void actualizar()
    {
        switch (filtro)
        {
            case "1":
                pedidos = dbContext.Pedidos.Where(x => x.Estado.ToLower().Trim() == "proceso").ToList();
                break;
            case "2":
                pedidos = dbContext.Pedidos.Where(x => x.Estado.ToLower().Trim() == "enviado").ToList();
                break;
            case "3":
                pedidos = dbContext.Pedidos.Where(x => x.Estado.ToLower().Trim() == "completado").ToList();
                break;
            default:
                pedidos = dbContext.Pedidos.ToList();
                break;
        }
    }
    protected override void OnInitialized()
    {
        pedidos = dbContext.Pedidos.ToList();
    }
}
